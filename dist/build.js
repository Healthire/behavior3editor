this.b3editor=this.b3editor||{},function(){"use strict";var a={zoom_initial:1,zoom_min:.25,zoom_max:2,zoom_step:.25,snap_x:16,snap_y:16,snap_offset_x:0,snap_offset_y:0,connection_width:2,anchor_border_width:2,anchor_radius:7,anchor_offset_x:4,anchor_offset_y:0,block_border_width:2,block_root_width:40,block_root_height:40,block_composite_width:40,block_composite_height:40,block_decorator_width:60,block_decorator_height:60,block_action_width:160,block_action_height:40,block_condition_width:160,block_condition_height:40};b3editor.OPTIONS=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a={key_select_all:"ctrl+a",key_deselect_all:"ctrl+shift+a",key_invert_selection:"ctrl+i",key_copy:"ctrl+c",key_cut:"ctrl+x",key_paste:"ctrl+v",key_duplicate:"ctrl+d",key_remove:"delete",key_organize:"a",key_zoom_in:"ctrl+up",key_zoom_out:"ctrl+down",key_new_tree:"ctrl+t",key_new_node:"ctrl+n",key_import_tree:"",key_export_tree:""};b3editor.SHORTCUTS=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a={background_color:"#171717",selection_color:"#4bb2fd",block_background_color:"#EFEFEF",block_border_color:"#6d6d6d",block_symbol_color:"#333",anchor_background_color:"#EFEFEF",anchor_border_color:"#6d6d6d",connection_color:"#6d6d6d"};b3editor.THEME_DARK=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(createjs.EventDispatcher),b=a.prototype;b.initialize=function(){this.storage=new b3editor.StorageProxy,this.storage.provider=new b3editor.LocalStorage,this.settings=new b3editor.SettingsManager,this.settings.load(b3editor.OPTIONS),this.settings.load(b3editor.THEME_DARK),this.settings.load(b3editor.SHORTCUTS),this.canvas=new b3editor.Game(this.settings),app.editor=this,app.settings=this.settings,app.game=this.canvas,this.project=new b3editor.Project,this.tree=null,this.trees=[],this.blocks=[],this.connections=[],this.selectedBlocks=[],this.nodes={},this.clipboard=[],this.symbols={},this.shapes={},this.systems=[],this.selectionBox=new b3editor.SelectionBox,this.defaultNodes=[b3editor.Root,b3.Sequence,b3.Priority,b3.MemSequence,b3.MemPriority,b3.Repeater,b3.RepeatUntilFailure,b3.RepeatUntilSuccess,b3.MaxTime,b3.Inverter,b3.Limiter,b3.Failer,b3.Succeeder,b3.Runner,b3.Error,b3.Wait],this.organizer=new b3editor.Organizer;var a={editor:this,canvas:this.canvas};this.registerSystem(new b3editor.CameraSystem(a)),this.registerSystem(new b3editor.SelectionSystem(a)),this.registerSystem(new b3editor.DragSystem(a)),this.registerSystem(new b3editor.ConnectionSystem(a)),this.registerShape("root",b3editor.draw.rootShape),this.registerShape("composite",b3editor.draw.compositeShape),this.registerShape("decorator",b3editor.draw.decoratorShape),this.registerShape("condition",b3editor.draw.conditionShape),this.registerShape("action",b3editor.draw.actionShape),this.registerSymbol("Root",b3editor.draw.rootSymbol),this.registerSymbol("Sequence",b3editor.draw.sequenceSymbol),this.registerSymbol("MemSequence",b3editor.draw.memsequenceSymbol),this.registerSymbol("Priority",b3editor.draw.prioritySymbol),this.registerSymbol("MemPriority",b3editor.draw.memprioritySymbol);for(var b=0;b<this.defaultNodes.length;b++)this.registerNode(this.defaultNodes[b]);this.canvas.layerOverlay.addChild(this.selectionBox.displayObject),this.addTree(),this.center()},b.trigger=function(a,b,c){c=c||{};var d=new createjs.Event(a);d._target=b;for(key in c)d[key]=c[key];this.dispatchEvent(d)},b.registerNode=function(a){var b=a.prototype.name;this.nodes[b]=a},b.registerSymbol=function(a,b){b||(b=a),this.symbols[a]=b},b.registerShape=function(a,b){this.shapes[a]=b},b.registerSystem=function(a,b){b?this.systems.splice(0,0,a):this.systems.push(a)},b.getRoot=function(){for(var a=0;a<this.blocks.length;a++)if("root"===this.blocks[a].category)return this.blocks[a]},b.getBlockUnder=function(a,b){if(!a||!b){var c=this.canvas.getLocalMousePosition();a=c.x,b=c.y}for(var d=this.blocks.length-1;d>=0;d--){var e=this.blocks[d];if(e.hitTest(a,b))return e}},b.getBlockById=function(a){for(var b=0;b<this.blocks.length;b++){var c=this.blocks[b];if(c.id==a)return c}},b.applySettings=function(a){var a=a||this.settings;this.canvas.applySettings(a);for(var b=0;b<this.blocks.length;b++)this.blocks[b].applySettings(a);for(var b=0;b<this.connections.length;b++)this.connections[b].applySettings(a)},b.importFromJSON=function(a){this.reset();var b=JSON.parse(a),c=null,d=b.display?!0:!1;if(b.custom_nodes)for(var e=0;e<b.custom_nodes.length;e++){var f=b.custom_nodes[e];this.nodes[f.name]||this.createNodeType(f)}for(var g in b.nodes){var h=b.nodes[g];h.display=h.display||{};var i=this.addBlock(h.name,h.display.x,h.display.y);i.id=h.id,i.title=h.title,i.description=h.description,i.properties=b3editor.extend({},h.parameters,h.properties),i.redraw(),i.id===b.root&&(c=i)}for(var g in b.nodes){var h=b.nodes[g],j=this.getBlockById(g),k=null;if("composite"==j.category&&h.children?k=h.children:("decorator"==j.category&&h.child||"root"==j.category&&h.child)&&(k=[h.child]),k)for(var e=0;e<k.length;e++){var l=this.getBlockById(k[e]);this.addConnection(j,l)}}c&&this.addConnection(this.getRoot(),c),b.display=b.display||{},this.canvas.camera.x=b.display.camera_x||0,this.canvas.camera.y=b.display.camera_y||0,this.canvas.camera.scaleX=b.display.camera_z||1,this.canvas.camera.scaleY=b.display.camera_z||1,d||this.organize(!0)},b.exportToJSON=function(){var a=this.getRoot(),b={};b.title=a.title,b.description=a.description,b.root=a.getOutNodeIds()[0]||null,b.display={camera_x:this.canvas.camera.x,camera_y:this.canvas.camera.y,camera_z:this.canvas.camera.scaleX,x:a.displayObject.x,y:a.displayObject.y},b.properties=a.properties,b.nodes={},b.custom_nodes=[];for(var c in this.nodes){var d=this.nodes[c];if(-1===this.defaultNodes.indexOf(d)){var e={name:d.prototype.name,title:d.prototype.title,category:d.prototype.category};b.custom_nodes.push(e)}}for(var f=0;f<this.blocks.length;f++){var g=this.blocks[f];if("root"!==g.category){var h={};h.id=g.id,h.name=g.name,h.title=g.title,h.description=g.description,h.display={x:g.displayObject.x,y:g.displayObject.y},h.parameters=g.parameters,h.properties=g.properties;var i=g.getOutNodeIdsByOrder();"composite"==g.category?h.children=i:("decorator"==g.category||"root"==g.category)&&(h.child=i[0]||null),b.nodes[g.id]=h}}return JSON.stringify(b,null,4)},b.addNode=function(a,b,c){if(this.nodes[a])return void this.trigger("notification",a,{level:"error",message:'Node named "'+a+'" already registered.'});var d={composite:b3.Composite,decorator:b3.Decorator,condition:b3.Condition,action:b3.Action},c=c,e=d[c],f=b3.Class(e);f.prototype.name=a,f.prototype.title=b,this.registerNode(f),this.trigger("nodeadded",f)},b.editNode=function(a,b,c){var d=this.nodes[a];if(d){if(a!==b&&this.nodes[b])return void this.trigger("notification",b,{level:"error",message:'Node named "'+b+'" already registered.'});delete this.nodes[a],this.nodes[b]=d;var e=d.prototype.title;d.prototype.name=b,d.prototype.title=c;for(var f=this.blocks.length-1;f>=0;f--){var g=this.blocks[f];g.node===d&&(g.name=b,(g.title===e||g.title===a)&&(g.title=c||b),g.redraw())}this.trigger("nodechanged",d)}},b.removeNode=function(a){this.deselectAll();for(var b=this.nodes[a],c=this.blocks.length-1;c>=0;c--){var d=this.blocks[c];d.node===b&&this.removeBlock(d)}delete this.nodes[a],this.trigger("noderemoved",b)},b.addTree=function(){var a=new b3editor.Block(this.nodes.Root);a.displayObject.x=0,a.displayObject.y=0;var b=new b3editor.Tree;return b.id=a.id,b.blocks=[a],this.trees.push(b),this.trigger("treeadded",b),this.selectTree(b.id),this.select(this.blocks[0]),this.center(),b},b.selectTree=function(a){var b=this.tree;b&&(b.blocks=this.blocks,b.connections=this.connections,b.selectedBlocks=this.selectedBlocks,b.camera={camera_x:this.canvas.camera.x,camera_y:this.canvas.camera.y,camera_z:this.canvas.camera.scaleX,x:this.blocks[0].displayObject.x,y:this.blocks[0].displayObject.y});for(var c=0;c<this.trees.length;c++)if(b=this.trees[c],b.id===a){this.tree=b,this.blocks=b.blocks,this.connections=b.connections,this.selectedBlocks=b.selectedBlocks,this.canvas.layerBlocks.removeAllChildren(),this.canvas.layerConnections.removeAllChildren();for(var c=0;c<this.blocks.length;c++)this.canvas.layerBlocks.addChild(this.blocks[c].displayObject);for(var c=0;c<this.connections.length;c++)this.canvas.layerConnections.addChild(this.connections[c].displayObject);return this.canvas.camera.x=b.camera.camera_x,this.canvas.camera.y=b.camera.camera_y,this.canvas.camera.scaleX=b.camera.camera_z,this.canvas.camera.scaleY=b.camera.camera_z,void this.trigger("treeselected",b)}this.trigger("notification",a,{level:"error",message:"Trying to select an invalid tree."})},b.removeTree=function(a){for(var b=-1,c=null,d=0;d<this.trees.length;d++)if(this.trees[d].id===a){c=this.trees[d],b=d;break}if(b>-1){if(this.trees.splice(b,1),c===this.tree){var e=null;e=b>0?this.trees[b-1].id:this.trees[b].id,this.selectTree(e)}this.trigger("treeremoved",c)}},b.zoom=function(a){this.canvas.camera.scaleX=a,this.canvas.camera.scaleY=a},b.pan=function(a,b){this.canvas.camera.x+=a,this.canvas.camera.y+=b},b.setcam=function(a,b){this.canvas.camera.x=a,this.canvas.camera.y=b},b.center=function(){var a=this.canvas.canvas.width/2,b=this.canvas.canvas.height/2;this.setcam(a,b)},b.organize=function(a){this.organizer.organize(this.getRoot(),a)},b.reset=function(a){for(var b=0;b<this.blocks.length;b++){var c=this.blocks[b];this.canvas.layerBlocks.removeChild(c.displayObject)}this.blocks=[];for(var b=0;b<this.connections.length;b++){var d=this.connections[b];this.canvas.layerConnections.removeChild(d.displayObject)}this.connections=[],this.canvas.camera.x=0,this.canvas.camera.y=0,this.canvas.camera.scaleX=1,this.canvas.camera.scaleY=1,a||(this.addBlock("Root",0,0),this.tree.id=this.blocks[0].id,this.tree.blocks=[this.blocks[0]])},b.snap=function(a){a?"[object Array]"!==Object.prototype.toString.call(a)&&(a=[a]):a=this.blocks;for(var b=this.settings.get("snap_x"),c=this.settings.get("snap_y"),d=0;d<a.length;d++){var e=a[d];e.displayObject.x-=e.displayObject.x%b,e.displayObject.y-=e.displayObject.y%c}},b.addBlock=function(a,b,c){if(b=b||0,c=c||0,"string"==typeof a)var d=this.nodes[a];else var d=a;var e=new b3editor.Block(d);return e.displayObject.x=b,e.displayObject.y=c,this.blocks.push(e),this.canvas.layerBlocks.addChild(e.displayObject),this.deselectAll(),this.select(e),e},b.addConnection=function(a,b){var c=new b3editor.Connection(this);return a&&(c.addInBlock(a),a.addOutConnection(c)),b&&(c.addOutBlock(b),b.addInConnection(c)),this.connections.push(c),this.canvas.layerConnections.addChild(c.displayObject),c.redraw(),c},b.editBlock=function(a,b){var c={title:a.title,description:a.description,properties:a.properties};a.title=b.title,a.description=b.description,a.properties=b.properties,a.redraw(),this.trigger("blockchanged",a,{oldValues:c,newValues:b})},b.removeBlock=function(a){var b=this.blocks.indexOf(a);if(b>-1&&this.blocks.splice(b,1),a.inConnection&&this.removeConnection(a.inConnection),a.outConnections.length>0)for(var c=a.outConnections.length-1;c>=0;c--)this.removeConnection(a.outConnections[c]);this.canvas.layerBlocks.removeChild(a.displayObject)},b.removeConnection=function(a){a.inBlock&&(a.inBlock.removeOutConnection(a),a.removeInBlock()),a.outBlock&&(a.outBlock.removeInConnection(),a.removeOutBlock());var b=this.connections.indexOf(a);b>-1&&this.connections.splice(b,1),this.canvas.layerConnections.removeChild(a.displayObject)},b.select=function(a){a.isSelected||(a.select(),this.selectedBlocks.push(a),this.trigger("blockselected",a))},b.deselect=function(a){if(a.isSelected){a.deselect();var b=this.selectedBlocks.indexOf(a);b>-1&&this.selectedBlocks.splice(b,1),this.trigger("blockdeselected",a)}},b.selectAll=function(){for(var a=0;a<this.blocks.length;a++)this.select(this.blocks[a])},b.deselectAll=function(){for(var a=this.selectedBlocks.length-1;a>=0;a--)this.deselect(this.selectedBlocks[a])},b.invertSelection=function(a){for(var b=a?[a]:this.blocks,c=0;c<b.length;c++){var a=b[c];a.isSelected?this.deselect(a):this.select(a)}},b.copy=function(){this.clipboard=[];for(var a=0;a<this.selectedBlocks.length;a++){var b=this.selectedBlocks[a];"root"!=b.category&&this.clipboard.push(b)}},b.cut=function(){this.clipboard=[];for(var a=0;a<this.selectedBlocks.length;a++){var b=this.selectedBlocks[a];"root"!=b.category&&(this.removeBlock(b),this.clipboard.push(b))}this.selectedBlocks=[]},b.paste=function(){for(var a=[],b=0;b<this.clipboard.length;b++){var c=this.clipboard[b],d=c.copy();d.displayObject.x+=50,d.displayObject.y+=50,this.blocks.push(d),this.canvas.layerBlocks.addChild(d.displayObject),a.push(d)}for(var b=0;b<this.clipboard.length;b++)for(var e=this.clipboard[b],d=a[b],f=0;f<e.outConnections.length;f++)for(var g=0;g<this.clipboard.length;g++)if(e.outConnections[f].outBlock===this.clipboard[g]){this.addConnection(d,a[g]);break}this.deselectAll();for(var b=0;b<a.length;b++)this.select(a[b]);this.snap(a)},b.duplicate=function(){var a=this.clipboard;this.copy(),this.paste(),this.clipboard=a},b.remove=function(){for(var a=null,b=0;b<this.selectedBlocks.length;b++)"root"==this.selectedBlocks[b].category?a=this.selectedBlocks[b]:this.removeBlock(this.selectedBlocks[b]);this.deselectAll(),a&&this.select(a)},b.removeConnections=function(){for(var a=0;a<this.selectedBlocks.length;a++){var b=this.selectedBlocks[a];if(b.inConnection&&this.removeConnection(b.inConnection),b.outConnections.length>0)for(var c=b.outConnections.length-1;c>=0;c--)this.removeConnection(b.outConnections[c])}},b.removeInConnections=function(){for(var a=0;a<this.selectedBlocks.length;a++){var b=this.selectedBlocks[a];b.inConnection&&this.removeConnection(b.inConnection)}},b.removeOutConnections=function(){for(var a=0;a<this.selectedBlocks.length;a++){var b=this.selectedBlocks[a];if(b.outConnections.length>0)for(var c=b.outConnections.length-1;c>=0;c--)this.removeConnection(b.outConnections[c])}},b.zoomIn=function(){var a=this.settings.get("zoom_min"),b=this.settings.get("zoom_max"),c=this.settings.get("zoom_step"),d=this.canvas.camera.scaleX;this.zoom(creatine.clip(d+c,a,b))},b.zoomOut=function(){var a=this.settings.get("zoom_min"),b=this.settings.get("zoom_max"),c=this.settings.get("zoom_step"),d=this.canvas.camera.scaleX;this.zoom(creatine.clip(d-c,a,b))},b.preview=function(a){var b=document.createElement("canvas");b.setAttribute("width","400"),b.setAttribute("height","200"),b.setAttribute("class","preview grabbing");var c=this.nodes[a],d=new b3editor.Block(c),e=d.displayObject;e.x=200,e.y=100;var f=new createjs.Stage(b);f.addChild(e),f.update();var g=document.createElement("img");return g.src=b.toDataURL(),g},b3editor.Editor=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(a){this.canvas=app.dom.gameCanvas,this.stage=new createjs.Stage(this.canvas),this.display=new creatine.Display(this.canvas),this.display.setUserSelect(!1),this.display.setTouchAction(!1),this.display.scaleMode=creatine.STRETCH,this.display.refresh(),this.stage.snapToPixelEnabled=!0,createjs.Ticker.setFPS(60),this.camera=new createjs.Container,this.layerConnections=new createjs.Container,this.layerBlocks=new createjs.Container,this.layerOverlay=new createjs.Container,this.applySettings(a),this.camera.addChild(this.layerConnections),this.camera.addChild(this.layerBlocks),this.camera.addChild(this.layerOverlay),this.stage.addChild(this.camera);var b=this;createjs.Ticker.addEventListener("tick",function(){b.stage.update()})},b.getLocalMousePosition=function(a,b){return"undefined"==typeof a&&(a=this.stage.mouseX),"undefined"==typeof b&&(b=this.stage.mouseY),this.camera.globalToLocal(a,b)},b.applySettings=function(a){this.canvas.style.background=a.get("background_color")},b3editor.Game=a}(),this.b3editor=this.b3editor||{},function(){"use strict";b3editor.extend=function(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[a].hasOwnProperty(b)&&(arguments[0][b]=arguments[a][b]);return arguments[0]}}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(){this._dict={}},b.clear=function(){this._dict={}},b.set=function(a,b){this._dict[a]=b},b.get=function(a){return this._dict[a]},b.load=function(a){for(var b in a)this.set(b,a[b])},b3editor.SettingsManager=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.name="Root",b.category="root",b.title="A Behavior Tree",b3editor.Root=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(){this.depth=0,this.leafCont=0,this.horizontalSpacing=208,this.verticalSpacing=64,this.orderByIndex=!1,this.connections=[],this.blocks=[]},b.__step=function(a){if(this.blocks.push(a),0==a.outConnections.length){this.leafCont++;var b=this.depth*this.horizontalSpacing,c=this.leafCont*this.verticalSpacing}else{var d=0;if(this.orderByIndex)var e=a.outConnections;else var e=a.getOutConnectionsByOrder();for(var f=0;f<e.length;f++)this.depth++,this.connections.push(e[f]),d+=this.__step(e[f].outBlock),this.depth--;var b=this.depth*this.horizontalSpacing,c=d/a.outConnections.length}return a.displayObject.x=b,a.displayObject.y=c,c},b.organize=function(a,b){if(a){this.depth=0,this.leafCont=0,this.connections=[],this.blocks=[],this.orderByIndex=b;var c=a.displayObject.x,d=a.displayObject.y,a=a;this.__step(a),c-=a.displayObject.x,d-=a.displayObject.y;for(var e=0;e<this.blocks.length;e++)this.blocks[e].displayObject.x+=c,this.blocks[e].displayObject.y+=d;for(var e=0;e<this.connections.length;e++)this.connections[e].redraw()}},b3editor.Organizer=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(){this.provider=null,this._contexts=["project","tree","node"]},b.set=function(a,b,c){if(this._contexts.indexOf(a)<0)throw'Invalid context "'+a+'"';this.provider.set(a,b,c)},b.get=function(a,b){if(this._contexts.indexOf(a)<0)throw'Invalid context "'+a+'"';return this.provider.get(a,b)},b.remove=function(a,b){if(this._contexts.indexOf(a)<0)throw'Invalid context "'+a+'"';this.provider.remove(a,b)},b.list=function(a){if(this._contexts.indexOf(a)<0)throw'Invalid context "'+a+'"';return this.provider.list(a)},b3editor.StorageProxy=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(){this._prefix="b3editor.storage.",this._storage=window.localStorage;try{!!window.localStorage.getItem}catch(a){this._storage={}}this._has("project-list")||this._set("project-list",[]),this._has("tree-list")||this._set("tree-list",[]),this._has("node-list")||this._set("node-list",[])},b._has=function(a){return this._prefix+a in this._storage},b._set=function(a,b){try{b=JSON.stringify(b)}catch(c){}this._storage[this._prefix+a]=b},b._get=function(a){var b=this._storage[this._prefix+a];try{b=JSON.parse(b)}catch(c){}return b},b._remove=function(a){delete this._storage[this._prefix+a]},b.set=function(a,b,c){var d=a+"."+b;if(!this._has(d)){var e=this._get(a+"-list");e.push(b),this._set(a+"-list",e)}this._set(d,c)},b.get=function(a,b){return this._get(a+"."+b)},b.remove=function(a,b){var c=a+"."+b;if(!this._has(c)){var d=this._get(a+"-list");d.splice(d.indexOf(b),1),this._set(a+"-list",d)}return this._remove(c)},b.list=function(a){return this._get(a+"-list")},b3editor.LocalStorage=a}(),this.b3editor=this.b3editor||{},this.b3editor.draw=this.b3editor.draw||{},function(){"use strict";var a=function(a,b,c,d,e,f,g){a.graphics.beginFill(e),a.graphics.setStrokeStyle(f,"round"),a.graphics.beginStroke(g),a.graphics.drawCircle(b,c,d),a.graphics.endStroke(),a.graphics.endFill()},b=function(a,b,c,d,e,f,g){a.graphics.beginFill(e),a.graphics.setStrokeStyle(f,"round"),a.graphics.beginStroke(g),a.graphics.drawRoundRect(-b/2,-c/2,b,c,d),a.graphics.endStroke(),a.graphics.endFill()},c=function(a,b,c,d,e,f){a.graphics.beginFill(d),a.graphics.setStrokeStyle(e,"round"),a.graphics.beginStroke(f),a.graphics.drawEllipse(-b/2,-c/2,b,c),a.graphics.endStroke(),a.graphics.endFill()},d=function(a,b,c,d,e,f){a.graphics.beginFill(d),a.graphics.setStrokeStyle(e,"round"),a.graphics.beginStroke(f),a.graphics.moveTo(0,c/2),a.graphics.lineTo(b/2,0),a.graphics.lineTo(0,-c/2),a.graphics.lineTo(-b/2,0),a.graphics.lineTo(0,c/2),a.graphics.endStroke(),a.graphics.endFill()};b3editor.draw.rootShape=function(c,d){var e=c._width,f=c._height,g=d.get("anchor_offset_x"),h=c._shapeObject;a(h,e/2+g,0,d.get("anchor_radius"),d.get("anchor_background_color"),d.get("anchor_border_width"),d.get("anchor_border_color")),b(h,e,f,15,d.get("block_background_color"),d.get("block_border_width"),d.get("block_border_color"))},b3editor.draw.compositeShape=function(c,d){var e=c._symbolObject.getBounds(),f=0;e&&(f=e.width+20);var g=Math.max(f,c._width),h=c._height,i=d.get("anchor_offset_x"),j=c._shapeObject;c._width=g,c._height=h,a(j,-g/2-i,0,d.get("anchor_radius"),d.get("anchor_background_color"),d.get("anchor_border_width"),d.get("anchor_border_color")),a(j,g/2+i,0,d.get("anchor_radius"),d.get("anchor_background_color"),d.get("anchor_border_width"),d.get("anchor_border_color")),b(j,g,h,15,d.get("block_background_color"),d.get("block_border_width"),d.get("block_border_color"))},b3editor.draw.decoratorShape=function(b,c){var e=b._symbolObject.getBounds(),f=Math.max(e.width+40,b._width),g=Math.max(e.height+50,b._height),h=c.get("anchor_offset_x"),i=b._shapeObject;b._width=f,b._height=g,a(i,-f/2-h,0,c.get("anchor_radius"),c.get("anchor_background_color"),c.get("anchor_border_width"),c.get("anchor_border_color")),a(i,f/2+h,0,c.get("anchor_radius"),c.get("anchor_background_color"),c.get("anchor_border_width"),c.get("anchor_border_color")),d(i,f,g,15,c.get("block_background_color"),c.get("block_border_width"),c.get("block_border_color"))},b3editor.draw.actionShape=function(c,d){var e=c._symbolObject.getBounds(),f=Math.max(e.width+15,c._width),g=Math.max(e.height+15,c._height),h=d.get("anchor_offset_x"),i=c._shapeObject;c._width=f,c._height=g,a(i,-f/2-h,0,d.get("anchor_radius"),d.get("anchor_background_color"),d.get("anchor_border_width"),d.get("anchor_border_color")),b(i,f,g,15,d.get("block_background_color"),d.get("block_border_width"),d.get("block_border_color"))},b3editor.draw.conditionShape=function(b,d){var e=b._symbolObject.getBounds(),f=Math.max(e.width+15,b._width),g=Math.max(e.height+15,b._height),h=d.get("anchor_offset_x"),i=b._shapeObject;b._width=f,b._height=g,a(i,-f/2-h,0,d.get("anchor_radius"),d.get("anchor_background_color"),d.get("anchor_border_width"),d.get("anchor_border_color")),c(i,f,g,d.get("block_background_color"),d.get("block_border_width"),d.get("block_border_color"))}}(),this.b3editor=this.b3editor||{},this.b3editor.draw=this.b3editor.draw||{},function(){"use strict";b3editor.draw.rootSymbol=function(a,b){var c=new createjs.Shape,d=(a._width,a._height),e=d/20,f=d/5,g=b.get("block_symbol_color");return c.graphics.setStrokeStyle(e,"round"),c.graphics.beginStroke(g),c.graphics.drawCircle(0,0,f),c.graphics.moveTo(-f,f),c.graphics.lineTo(f,-f),c.graphics.endStroke(),c},b3editor.draw.sequenceSymbol=function(a,b){var c=new createjs.Shape,d=(a._width,a._height),e=d/20,f=d/4,g=b.get("block_symbol_color");return c.graphics.setStrokeStyle(e,"round"),c.graphics.beginStroke(g),c.graphics.beginFill(g),c.graphics.moveTo(-f,0),c.graphics.lineTo(f,0),c.graphics.drawPolyStar(f/2,0,f/2,3,0,0),c.graphics.endFill(),c.graphics.endStroke(),c},b3editor.draw.memsequenceSymbol=function(a,b){var c=new createjs.Shape,d=(a._width,a._height),e=d/20,f=d/4,g=b.get("block_symbol_color");return c.graphics.setStrokeStyle(e,"round"),c.graphics.beginStroke(g),c.graphics.beginFill(g),c.graphics.drawPolyStar(0,.75*-f,f/2,6,f/10,0),c.graphics.setStrokeStyle(e,"round"),c.graphics.beginStroke(g),c.graphics.beginFill(g),c.graphics.moveTo(-f,f/2),c.graphics.lineTo(f,f/2),c.graphics.drawPolyStar(f/2,f/2,f/2,3,0,0),c.graphics.endFill(),c.graphics.endStroke(),c},b3editor.draw.prioritySymbol=function(a,b){var c=new createjs.Shape,d=(a._width,a._height),e=d/20,f=d/8,g=b.get("block_symbol_color");return c.graphics.setStrokeStyle(e,"round"),c.graphics.beginStroke(g),c.graphics.arc(0,-f,f,3.141561,1.570796,!1),c.graphics.lineTo(0,f),c.graphics.beginFill(g),c.graphics.drawCircle(0,2*f,e/2),c.graphics.endFill(),c.graphics.endStroke(),c},b3editor.draw.memprioritySymbol=function(a,b){var c=new createjs.Shape,d=(a._width,a._height),e=d/20,f=d/8,g=b.get("block_symbol_color");return c.graphics.setStrokeStyle(e,"round"),c.graphics.beginStroke(g),c.graphics.arc(-f,-f,f,3.141561,1.570796,!1),c.graphics.lineTo(-f,f),c.graphics.beginFill(g),c.graphics.drawCircle(-f,2*f,e/2),c.graphics.drawPolyStar(1.5*f,0,f/2,6,f/10,0),c.graphics.endFill(),c.graphics.endStroke(),c},b3editor.draw.textSymbol=function(a){var b=new createjs.Text(a.getTitle(),"18px Arial","#333333");b.textAlign="center";var c=b.getBounds();return b.regY=c.height/2,b}}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(){this.name=null,this.filePath=null,this.trees=[],this.customNodes=[]},b3editor.Project=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(){this.id=0,this.blocks=[],this.connections=[],this.selectedBlocks=[],this.camera={camera_x:0,camera_y:0,camera_z:1,x:0,y:0}},b3editor.Tree=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(){this.spec=null,this.name=null,this.title=null,this.category=null,this.description=null,this.properties=null},b3editor.Node=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(a){var b=a.prototype;b||(b=a),this.id=b3.createUUID(),this.node=a,this.name=b.name,this.category=b.category,this.title=b.title||this.name,this.description=b.description||"",this.properties=b3editor.extend({},b.parameters,b.properties),this.displayObject=new createjs.Container,this.inConnection=null,this.outConnections=[],this.isSelected=!1,this.isDragging=!1,this.dragOffsetX=0,this.dragOffsetX=0,this._width=null,this._height=null,this._shapeObject=new createjs.Shape,this._shadowObject=null,this._symbolObject=null,this.applySettings(app.settings)},b.applySettings=function(a){this.settings=a||this.settings,this._shadowObject=new createjs.Shadow(this.settings.get("selection_color"),0,0,5),this.redraw()},b.copy=function(){var a=new b3editor.Block(this.node);return a.displayObject.x=this.displayObject.x,a.displayObject.y=this.displayObject.y,a._width=this._width,a._height=this._height,a.anchorXOffset=this.anchorXOffset,a.category=this.category,a.title=this.title,a.description=this.description,a},b.redraw=function(){var a=this.settings,b=this.name,c=this.category.toLowerCase(),d=app.editor.shapes[c],e=app.editor.symbols[b]||b3editor.draw.textSymbol;this._width=a.get("block_"+c+"_width"),this._height=a.get("block_"+c+"_height"),this.displayObject.removeAllChildren(),this._symbolObject=e(this,a),this._shapeObject.graphics.clear(),d(this,a),this.displayObject.addChild(this._shapeObject),this.displayObject.addChild(this._symbolObject)},b.getTitle=function(){var a=this.title||this.name,b=this;return a.replace(/(<\w+>)/g,function(a,c){var d=c.substring(1,c.length-1);return b.properties.hasOwnProperty(d)?b.properties[d]:a})},b.select=function(){this.isSelected=!0,this._shapeObject.shadow=this._shadowObject},b.deselect=function(){this.isSelected=!1,this._shapeObject.shadow=null},b.getOutNodeIds=function(){for(var a=[],b=0;b<this.outConnections.length;b++)a.push(this.outConnections[b].outBlock.id);return a},b.getOutNodeIdsByOrder=function(){for(var a=[],b=this.getOutConnectionsByOrder(),c=0;c<b.length;c++)a.push(b[c].outBlock.id);return a},b.getOutConnectionsByOrder=function(){var a=this.outConnections.slice(0);return a.sort(function(a,b){return a.outBlock.displayObject.y-b.outBlock.displayObject.y}),a},b.addInConnection=function(a){this.inConnection=a},b.addOutConnection=function(a){this.outConnections.push(a)},b.removeInConnection=function(){this.inConnection=null},b.removeOutConnection=function(a){var b=this.outConnections.indexOf(a);b>-1&&this.outConnections.splice(b,1)},b.hitTest=function(a,b){return a-=this.displayObject.x,b-=this.displayObject.y,this._shapeObject.hitTest(a,b)},b.isContainedIn=function(a,b,c,d){return a<this.displayObject.x-this._width/2&&b<this.displayObject.y-this._height/2&&c>this.displayObject.x+this._width/2&&d>this.displayObject.y+this._height/2?!0:!1},b.getLeftAnchorX=function(){return this.displayObject.x-this._width/2-this.settings.get("anchor_offset_x")},b.getRightAnchorX=function(){return this.displayObject.x+this._width/2+this.settings.get("anchor_offset_x")},b.mouseInBlock=function(a){return Math.abs(a-this.displayObject.x)<this._width/2},b.mouseInLeftAnchor=function(a){var b=a-this.displayObject.x;return Math.abs(b)>this._width/2&&0>b},b.mouseInRightAnchor=function(a){var b=a-this.displayObject.x;return Math.abs(b)>this._width/2&&b>0},b3editor.Block=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(){this.inBlock=null,this.outBlock=null,this.settings=null,this.displayObject=new createjs.Shape,this.applySettings(app.settings)},b.addInBlock=function(a){this.inBlock=a},b.addOutBlock=function(a){this.outBlock=a},b.removeInBlock=function(){this.inBlock=null},b.removeOutBlock=function(){this.outBlock=null},b.applySettings=function(a){this.settings=a,this.redraw()},b.redraw=function(a,b,c,d){if((this.inBlock||null!=a||null!=b)&&(this.outBlock||null!=c||null!=d)){var e=this.settings,f=this.displayObject.graphics,g=e.get("connection_width"),h=e.get("connection_color"),i=e.get("anchor_radius")+e.get("anchor_border_width"),j=e.get("anchor_radius")/2;a=0==a||a?a:this.inBlock.getRightAnchorX(),c=0==c||c?c:this.outBlock.getLeftAnchorX()-i,b=0==b||b?b:this.inBlock.displayObject.y,d=0==d||d?d:this.outBlock.displayObject.y;var k=2.5*(c-a)/4;f.clear(),f.setStrokeStyle(g,"round"),f.beginStroke(h),f.moveTo(a,b),f.bezierCurveTo(a+k,b,c-k,d,c,d),f.beginFill(h),f.drawPolyStar(c-j,d,j,3,0,0),f.endFill(),f.endStroke()}},b3editor.Connection=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(){this.settings=null,this.displayObject=new createjs.Shape,this.displayObject.alpha=.3,this.displayObject.visible=!1,this.applySettings(app.settings)},b.applySettings=function(a){this.settings=a,this.redraw()},b.redraw=function(a,b,c,d){var e=this.settings.get("selection_color"),f=this.displayObject.graphics,g=Math.min(a,c),h=Math.min(b,d),i=Math.abs(a-c),j=Math.abs(b-d);f.clear(),f.beginFill(e),f.drawRect(g,h,i,j),f.endFill()},b3editor.SelectionBox=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(a){this.editor=a.editor,this.canvas=a.canvas,this.isDragging=!1,this.offsetX=0,this.offsetY=0;var b=this;this.canvas.stage.on("stagemousedown",this.onMouseDown,this),this.canvas.stage.on("stagemousemove",this.onMouseMove,this),this.canvas.stage.on("stagemouseup",this.onMouseUp,this),this.canvas.canvas.addEventListener("mousewheel",function(a){b.onMouseWheel(a)}),this.canvas.canvas.addEventListener("DOMMouseScroll ",function(a){b.onMouseWheel(a)},!1)},b.onMouseDown=function(a){2===a.nativeEvent.which&&(this.canvas.canvas.className+=" grabbing",this.isDragging=!0,this.offsetX=this.canvas.stage.mouseX-this.canvas.camera.x,this.offsetY=this.canvas.stage.mouseY-this.canvas.camera.y)},b.onMouseMove=function(){this.isDragging&&(this.canvas.camera.x=this.canvas.stage.mouseX-this.offsetX,this.canvas.camera.y=this.canvas.stage.mouseY-this.offsetY)},b.onMouseUp=function(a){2===a.nativeEvent.which&&(this.canvas.canvas.className=this.canvas.canvas.className.replace(/(?:^|\s)grabbing(?!\S)/g,""),this.isDragging=!1,this.offsetX=0,this.offsetY=0)
},b.onMouseWheel=function(a){a.wheelDeltaY>0?this.editor.zoomIn():this.editor.zoomOut()},b3editor.CameraSystem=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(a){this.editor=a.editor,this.canvas=a.canvas,this.entity=null,this.canvas.stage.on("stagemousedown",this.onMouseDown,this),this.canvas.stage.on("stagemousemove",this.onMouseMove,this),this.canvas.stage.on("stagemouseup",this.onMouseUp,this)},b.onMouseDown=function(a){if(1===a.nativeEvent.which){var b=this.canvas.getLocalMousePosition(),c=b.x,d=b.y,e=this.editor.getBlockUnder(c,d);if(!this.entity&&e)if(e.mouseInRightAnchor(c,d))this.entity=this.editor.addConnection(e);else if(e.mouseInLeftAnchor(c,d)){var f=e.inConnection;if(!f)return;e.removeInConnection(),f.removeOutBlock(),this.entity=f}}},b.onMouseMove=function(){if(this.entity){var a=this.canvas.getLocalMousePosition(),b=a.x,c=a.y;this.entity.redraw(null,null,b,c)}},b.onMouseUp=function(a){if(1===a.nativeEvent.which&&this.entity){var b=this.canvas.getLocalMousePosition(),c=b.x,d=b.y,e=this.editor.getBlockUnder(c,d);e&&e!==this.entity.inBlock&&"root"!==e.category?(e.inConnection&&this.editor.removeConnection(e.inConnection),("root"===this.entity.inBlock.category||"decorator"===this.entity.inBlock.category)&&this.entity.inBlock.outConnections.length>1&&this.editor.removeConnection(this.entity.inBlock.outConnections[0]),this.entity.addOutBlock(e),e.addInConnection(this.entity),this.entity.redraw()):this.editor.removeConnection(this.entity),this.entity=null}},b3editor.ConnectionSystem=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(a){this.editor=a.editor,this.canvas=a.canvas,this.isDragging=!1,this.canvas.stage.on("stagemousedown",this.onMouseDown,this),this.canvas.stage.on("stagemousemove",this.onMouseMove,this),this.canvas.stage.on("stagemouseup",this.onMouseUp,this)},b.onMouseDown=function(a){if(1===a.nativeEvent.which&&!keyboard.ctrl&&!this.isDragging){var b=this.canvas.getLocalMousePosition(),c=b.x,d=b.y,e=this.editor.getBlockUnder(c,d);if(e&&e.isSelected&&e.mouseInBlock(c,d)){this.isDragging=!0;for(var f=0;f<this.editor.selectedBlocks.length;f++){var e=this.editor.selectedBlocks[f];e.isDragging=!0,e.dragOffsetX=c-e.displayObject.x,e.dragOffsetY=d-e.displayObject.y}}}},b.onMouseMove=function(){if(this.isDragging)for(var a=this.canvas.getLocalMousePosition(),b=a.x,c=a.y,d=0;d<this.editor.selectedBlocks.length;d++){var e=this.editor.selectedBlocks[d],f=b-e.dragOffsetX,g=c-e.dragOffsetY;e.displayObject.x=f-f%this.editor.settings.get("snap_x"),e.displayObject.y=g-g%this.editor.settings.get("snap_y"),e.inConnection&&e.inConnection.redraw();for(var h=0;h<e.outConnections.length;h++)e.outConnections[h].redraw()}},b.onMouseUp=function(a){if(1===a.nativeEvent.which&&this.isDragging){this.isDragging=!1;for(var b=0;b<this.editor.selectedBlocks.length;b++){var c=this.editor.selectedBlocks[b];c.isDragging=!1}}},b3editor.DragSystem=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(a){this.editor=a.editor,this.canvas=a.canvas,this.isSelecting=!1,this.ctrl=!1,this.x1=0,this.y1=0,this.canvas.stage.on("stagemousedown",this.onMouseDown,this),this.canvas.stage.on("stagemousemove",this.onMouseMove,this),this.canvas.stage.on("stagemouseup",this.onMouseUp,this)},b.onMouseDown=function(a){if(1===a.nativeEvent.which){var b=this.canvas.getLocalMousePosition(),c=b.x,d=b.y,e=this.editor.getBlockUnder(c,d);e?e.isSelected?keyboard.ctrl&&this.editor.deselect(e):e.mouseInBlock(c,d)&&(keyboard.ctrl||this.editor.deselectAll(),this.editor.select(e)):(this.isSelecting=!0,this.x1=c,this.y1=d,keyboard.ctrl?this.ctrl=!0:this.editor.deselectAll())}},b.onMouseMove=function(){if(this.isSelecting){var a=this.canvas.getLocalMousePosition(),b=a.x,c=a.y;this.editor.selectionBox.displayObject.visible=!0,this.editor.selectionBox.redraw(this.x1,this.y1,b,c)}},b.onMouseUp=function(a){if(1===a.nativeEvent.which&&this.isSelecting){for(var b=this.canvas.getLocalMousePosition(),c=b.x,d=b.y,e=Math.min(this.x1,c),f=Math.min(this.y1,d),g=Math.max(this.x1,c),h=Math.max(this.y1,d),i=0;i<this.editor.blocks.length;i++){var j=this.editor.blocks[i];j.isContainedIn(e,f,g,h)&&this.editor.invertSelection(j)}this.editor.selectionBox.displayObject.visible=!1,this.isSelecting=!1,this.ctrl=!1}},b3editor.SelectionSystem=a}();